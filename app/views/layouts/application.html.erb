<!DOCTYPE html>
<html>
  <head>
    <title><%= [content_for(:title), "Manabiya"].compact.join(" - ") %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>

    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="bg-neutral-100">
    <% if logged_in? %>
      <%# === PC: サイドバー === %>
      <%= render "layouts/sidebar" %>

      <%# === モバイル: トップバー === %>
      <header class="sticky top-0 z-30 md:hidden bg-white border-b border-neutral-200 px-4 py-3 flex justify-between items-center">
        <h1 class="text-xl font-bold">
          <%= link_to "Manabiya", root_path, class: "text-rose-500 hover:text-rose-600" %>
        </h1>
        <%= link_to member_path(current_member) do %>
          <%= image_tag(current_member.icon_url, class: "w-8 h-8 rounded-full", size: "32x32") %>
        <% end %>
      </header>

      <%# === メインコンテンツ === %>
      <main class="md:ml-64 pb-20 md:pb-0">
        <% if notice || alert %>
          <p class="m-4 mb-0 p-4 bg-rose-500 text-white shadow-md rounded-md"><%= notice || alert %></p>
        <% end %>
        <div class="p-4">
          <%= yield %>
        </div>
      </main>

      <%# === モバイル: 下部ナビ === %>
      <%= render "layouts/bottom_nav" %>
    <% else %>
      <%# === 未ログイン: ゲートレイアウト === %>
      <div class="min-h-screen flex items-center justify-center px-4">
        <div class="bg-white rounded-lg shadow-md p-8 w-full max-w-md">
          <h1 class="text-3xl font-bold text-rose-500 mb-6 text-center">Manabiya</h1>
          <% if notice || alert %>
            <p class="mb-4 p-4 bg-rose-500 text-white shadow-md rounded-md"><%= notice || alert %></p>
          <% end %>
          <%= yield %>
        </div>
      </div>
    <% end %>
  </body>
</html>
